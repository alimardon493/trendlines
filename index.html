string API_KEY = "KY46C6NO0OQGX7NA";

double GetPrice()
{
   string url = "https://www.alphavantage.co/query?function=CURRENCY_EXCHANGE_RATE&from_currency=EUR&to_currency=USD&apikey=" + API_KEY;

   char data[];
   int res = WebRequest("GET", url, NULL, 5000, data, NULL);

   if(res != 200) {
      Print("API error: ", res);
      return 0;
   }

   string json = CharArrayToString(data);
   string ask = Parse(json, "\"8. Bid Price\": \"", "\"");
   
   return StrToDouble(ask);
}

// JSON dan qiymat olish
string Parse(string text, string start, string end)
{
   int a = StringFind(text, start);
   if(a < 0) return "";
   a += StringLen(start);

   int b = StringFind(text, end, a);
   if(b < 0) return "";

   return StringSubstr(text, a, b - a);
}
